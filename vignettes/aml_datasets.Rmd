---
title: "AML datasets"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
    collapse = TRUE,
    comment = "#>",
    warning = FALSE,
    message = FALSE
)
```

# {.tabset .tabset-fade}

## Mouse datasets {.tabset .tabset-fade}
Note: Validation mice also avaialable via Haemdata/Ondrive. See [X]() for more details.

First, we need to setup the pin-board and download the mouse datasets. 

```{r setup}
library(haemdata)
use_pinboard("onedrive")

all_mice <- get_pin("mmu_mrna_2016_2022_GENCODEm28_HLT_qc.rds")
```

### 2016 mice
```{r}
se <- subset(all_mice,
    select = grepl("2016", SummarizedExperiment::colData(all_mice)$batch)
)

pca <- pca_se(se)
```

```{r}
pca$biplot
pca$pairs_plot
```
```{r fig.height=9, fig.width=8}
pca$correlation_plot
```

```{r}
plot_transgenes_se(se)
```

### 2018 mice
```{r}
se <- subset(all_mice,
    select = grepl("AML.mRNA.2018.all_samples", SummarizedExperiment::colData(all_mice)$project)
)

pca <- pca_se(se)
```

```{r }
pca$biplot
pca$pairs_plot
```
```{r fig.height=9, fig.width=8}
pca$correlation_plot
```

```{r }
plot_transgenes_se(se)
```

### Radiation mice
```{r}
se <- subset(all_mice,
    select = grepl("AML.mRNA.2020", SummarizedExperiment::colData(all_mice)$project)
)
se <- subset(se,
    select = grepl("PBMC", SummarizedExperiment::colData(se)$tissue)
)

pca <- pca_se(se)
```

```{r }
pca$biplot
pca$pairs_plot
```

```{r fig.height=9, fig.width=8}
pca$correlation_plot
```

```{r }
plot_transgenes_se(se)
```

### Chemo mice
```{r}
se <- subset(all_mice,
    select = grepl("RxGroup", SummarizedExperiment::colData(all_mice)$project)
)

pca <- pca_se(se)
```

```{r }
pca$biplot
pca$pairs_plot
```

```{r fig.height=9, fig.width=8}
pca$correlation_plot
```

```{r }
plot_transgenes_se(se)
```

### scRNAseq mice
```{r}
se <- subset(all_mice,
    select = grepl("AML.scRNAseq.2022", SummarizedExperiment::colData(all_mice)$project)
)

pca <- pca_se(se)
```

```{r }
pca$biplot
pca$pairs_plot
```

```{r fig.height=9, fig.width=8}
pca$correlation_plot
```

```{r }
plot_transgenes_se(se)
```

### Bone marrow
```{r}
se <- subset(all_mice,
    select = ("BM" == SummarizedExperiment::colData(all_mice)$tissue)
)

pca <- pca_se(se)
```

```{r }
pca$biplot
pca$pairs_plot
```

```{r fig.height=9, fig.width=8}
pca$correlation_plot
```

```{r }
plot_transgenes_se(se)
```

## Human datasets {.tabset .tabset-fade}

First, we need to setup the pin-board from which well retrieve the human datasets

```{r, eval=FALSE}
library(haemdata)
use_pinboard("onedrive")
```

### COH patients 

City of Hope Biobank FLT3 patients

**Include some background info on these samples, IRB etc**

```{r }
se <- get_pin("hsa_mrna_flt3_GENCODEr40_qc.rds")

## Add week_scaled column, where time is scaled for each patient
SummarizedExperiment::colData(se) <- SummarizedExperiment::colData(se) |>
    janitor::remove_constant() |>
    dplyr::as_tibble() |>
    dplyr::group_by(patient_id) |>
    dplyr::mutate(weeks_scaled = as.vector(scale(weeks))) |>
    dplyr::ungroup() |>
    `rownames<-`(colnames(se)) |>
    S4Vectors::DataFrame()

pca <- pca_se(se, col_by = "weeks_scaled")
```

```{r }
pca$biplot
pca$pairs_plot
```
```{r  fig.height=9, fig.width=8}
pca$correlation_plot
```

### Relapse patients
Kim et al 2020 *Sci Rep* [![DOI](https://zenodo.org/badge/DOI/10.1038/s41598-020-76933-2.svg)](https://doi.org/10.1038/s41598-020-76933-2)

Bioproject: [PRJEB27973](https://www.ncbi.nlm.nih.gov/bioproject/?term=PRJEB27973)

```{r }
se <- get_pin("hsa_mrna_kim_GENCODEr40_qc.rds")

pca <- pca_se(se, col_by = "timepoint")
```

```{r }
pca$biplot
pca$pairs_plot
```
```{r  fig.height=9, fig.width=8}
pca$correlation_plot
```
